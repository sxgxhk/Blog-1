---
import ImageWrapper from "../components/misc/ImageWrapper.astro";
import I18nKey from "../i18n/i18nKey";
import { i18n } from "../i18n/translation";
import MainGridLayout from "../layouts/MainGridLayout.astro";

// 追番数据
const animeList = [
	{
		title: "百妖谱·洛阳篇",
		status: "completed",
		rating: 9.8,
		cover: "/images/anime/byp-ly.webp",
		description: "桃夭独自踏入洛阳城。这座千年古都的街巷里，藏着无数精怪与人心交织的隐秘。她此行治妖的病，也暖人的心。她为绛君多争取一日，为咸鼠打破不救人的惯例，也是在洛阳，她相继遇到了佛眼、玄狏、婴源、人渠、狭怪。也终于遇到了藏匿许久的百妖谱。——治病，救妖，追寻百妖谱的踪迹，这才是“桃都灵医”的日常。",
		episodes: "12 episodes",
		year: "2025",
		genre: ["小说改", "古风", "玄幻", "治愈"],
		studio: "绘梦动画",
		link: "https://www.bilibili.com/bangumi/media/md23772558",
		progress: 12,
		totalEpisodes: 12,
		startDate: "2025-08",
		endDate: "2025-09",
	},
	{
		title: "百妖谱·司府篇 ",
		status: "completed",
		rating: 9.2,
		cover: "/images/anime/byp-sf.webp",
		description: "在第三季中，桃夭追着百妖谱的气息一路来到京师，为了养活一僧一蛇一狐，她在京师的大户人家“司府”担任喂马杂役。尽管自称只救妖不救人，但当面对暗刀、百知、风果、孰湖、枫生、趸鱼、镇水等妖怪和事中人时，桃夭心怀善念，解铃还愿。这一季充满了情感与冒险，展现出一系列感人至深的治愈故事~",
		episodes: "12 episodes",
		year: "2024",
		genre: ["小说改", "古风", "玄幻", "治愈"],
		studio: "绘梦动画",
		link: "https://www.bilibili.com/bangumi/media/md28339938",
		progress: 12,
		totalEpisodes: 12,
		startDate: "2024-02",
		endDate: "2024-04",
	},
	{
		title: "百妖谱·京师篇",
		status: "completed",
		rating: 9.8,
		cover: "/images/anime/byp-js.webp",
		description: "围绕桃夭、柳公子、磨牙一行在京师的游历，展示了人与人，人与妖之间的距离或许并没有想象中的那么难以逾越。无论是桃夭与丁三四的互动，还是老张带给柳公子跨越人生和厨艺的指点，亦或是磨牙面对傒囊时的左右为难，都让一行人各自获得新的成长。而同时，封无乐，陈白水等人也获得各自的救赎，或许人生旅途就是这般互相影响，五味杂陈。",
		episodes: "12 episodes",
		year: "2022",
		genre: ["小说改", "玄幻", "古风", "治愈"],
		studio: "绘梦动画",
		link: "https://www.bilibili.com/bangumi/media/md28235355",
		progress: 12,
		totalEpisodes: 12,
		startDate: "2022-07",
		endDate: "2022-09",
	},
	{
		title: "百妖谱 第二季",
		status: "completed",
		rating: 9.2,
		cover: "/images/anime/byp-2.webp",
		description: "桃都的灵医桃夭带着小和尚磨牙、第一季收服的小狐妖、桃都老邻居柳公子一起继续第一季的故事，为了寻找失踪的百妖谱而云游四方，在途中遇到应声、化蛇、媪姬、照海四个妖怪，为妖怪治疗各种疑难杂症。",
		episodes: "12 episodes",
		year: "2021",
		genre: ["小说改", "玄幻", "治愈", "催泪"],
		studio: "绘梦动画",
		link: "https://www.bilibili.com/bangumi/media/md28230717",
		progress: 12,
		totalEpisodes: 12,
		startDate: "2021-07",
		endDate: "2021-09",
	},
	{
		title: "百妖谱",
		status: "completed",
		rating: 9.4,
		cover: "/images/anime/byp.webp",
		description: "灵医桃夭，善恶如谜。金铃过处，片甲不留。讲百种妖怪，述世间沧桑。她是所有妖怪的救星，也是所有妖怪的噩梦。她带着磨牙小和尚行走江湖，也是灵医桃夭。桃都灵医桃夭只治妖怪不治人，她带着小和尚磨牙一起云游四方，顺道给各路妖怪治病。磨牙的跟班狐狸滚滚，加上她们的老邻居蛇妖柳公子，也先后加入结伴而行，在这妖怪横行、惊险重重，却又让人眷念的人间大显神通，为周围的妖怪治疗各种疑难杂症，也为这些妖怪周围的人类排忧解难。桃夭、磨牙和柳公子之间的关系不显山不露水，更多稀奇古怪的问题等着这个小团队一起去探索解决。冰山的一角可以窥探整个故事的磅礴精致，这是一场华丽未知的探险。同主角们一起，把一个个寓言般的小故事串联成一个精彩纷呈的大千世界……",
		episodes: "12 episodes",
		year: "2020",
		genre: ["小说改", "玄幻", "治愈", "古风"],
		studio: "绘梦动画",
		link: "https://www.bilibili.com/bangumi/media/md23772558",
		progress: 12,
		totalEpisodes: 12,
		startDate: "2020-04",
		endDate: "2020-06",
	},
];

// 获取状态的翻译文本和样式
function getStatusInfo(status: string) {
  switch (status) {
    case "watching":
      return {
        text: i18n(I18nKey.animeStatusWatching),
        class: "bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-300",
        icon: `
          <svg xmlns="http://www.w3.org/2000/svg" class="w-3 h-3 inline" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z" />
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
          </svg>
        `
      };
    case "completed":
      return {
        text: i18n(I18nKey.animeStatusCompleted),
        class: "bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-300",
        icon: `
          <svg xmlns="http://www.w3.org/2000/svg" class="w-3 h-3 inline" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
          </svg>
        `
      };
    case "planned":
      return {
        text: i18n(I18nKey.animeStatusPlanned),
        class: "bg-amber-100 text-amber-700 dark:bg-amber-900/30 dark:text-amber-300",
        icon: `
          <svg xmlns="http://www.w3.org/2000/svg" class="w-3 h-3 inline" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
          </svg>
        `
      };
    default:
      return {
        text: status,
        class: "bg-gray-100 text-gray-700 dark:bg-gray-800 dark:text-gray-300",
        icon: `
          <svg xmlns="http://www.w3.org/2000/svg" class="w-3 h-3 inline" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
          </svg>
        `
      };
  }
}

// 计算统计数据
const stats = {
	total: animeList.length,
	watching: animeList.filter((anime) => anime.status === "watching").length,
	completed: animeList.filter((anime) => anime.status === "completed").length,
	avgRating: (
		animeList.reduce((sum, anime) => sum + anime.rating, 0) / animeList.length
	).toFixed(1),
};
---

<MainGridLayout title={i18n(I18nKey.anime)} description={i18n(I18nKey.animeSubtitle)}>
	<div class="flex w-full rounded-[var(--radius-large)] overflow-hidden relative min-h-32">
		<div class="card-base z-10 px-9 py-6 relative w-full">
			<!-- 页面标题 -->
			<div class="relative w-full mb-8">
				<div class="mb-6">
					<h1 class="text-4xl font-bold text-black/90 dark:text-white/90 mb-2">{i18n(I18nKey.animeTitle)}</h1>
				</div>
				
				<!-- 统计卡片 -->
				<div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
					<!-- 总数卡片 -->
					<div class="bg-gradient-to-br from-blue-50 to-blue-100 dark:from-blue-900/20 dark:to-blue-800/20 rounded-xl p-4">
						<div class="flex items-center gap-3">
						<div class="w-8 h-8 text-blue-600 dark:text-blue-400">
							<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
							<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
							</svg>
						</div>
						<div>
							<div class="text-2xl font-bold text-blue-600 dark:text-blue-400">{stats.total}</div>
							<div class="text-sm text-blue-600/70 dark:text-blue-400/70">{i18n(I18nKey.animeTotal)}</div>
						</div>
						</div>
					</div>
					
					<!-- 正在观看卡片 -->
					<div class="bg-gradient-to-br from-green-50 to-green-100 dark:from-green-900/20 dark:to-green-800/20 rounded-xl p-4">
						<div class="flex items-center gap-3">
						<div class="w-8 h-8 text-green-600 dark:text-green-400">
							<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
							<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z" />
							<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
							</svg>
						</div>
						<div>
							<div class="text-2xl font-bold text-green-600 dark:text-green-400">{stats.watching}</div>
							<div class="text-sm text-green-600/70 dark:text-green-400/70">{i18n(I18nKey.animeWatching)}</div>
						</div>
						</div>
					</div>
					
					<!-- 已完成卡片 -->
					<div class="bg-gradient-to-br from-purple-50 to-purple-100 dark:from-purple-900/20 dark:to-purple-800/20 rounded-xl p-4">
						<div class="flex items-center gap-3">
						<div class="w-8 h-8 text-purple-600 dark:text-purple-400">
							<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
							<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
							</svg>
						</div>
						<div>
							<div class="text-2xl font-bold text-purple-600 dark:text-purple-400">{stats.completed}</div>
							<div class="text-sm text-purple-600/70 dark:text-purple-400/70">{i18n(I18nKey.animeCompleted)}</div>
						</div>
						</div>
					</div>
					
					<!-- 平均评分卡片 -->
					<div class="bg-gradient-to-br from-orange-50 to-orange-100 dark:from-orange-900/20 dark:to-orange-800/20 rounded-xl p-4">
						<div class="flex items-center gap-3">
						<div class="w-8 h-8 text-orange-600 dark:text-orange-400">
							<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
							<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z" />
							</svg>
						</div>
						<div>
							<div class="text-2xl font-bold text-orange-600 dark:text-orange-400">{stats.avgRating}</div>
							<div class="text-sm text-orange-600/70 dark:text-orange-400/70">{i18n(I18nKey.animeAvgRating)}</div>
						</div>
						</div>
					</div>
				</div>

			<!-- 动漫列表 -->
			<div class="mb-8">
				<h2 class="text-2xl font-bold text-black/90 dark:text-white/90 mb-4">
					{i18n(I18nKey.animeList)}
				</h2>
				<div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4 md:gap-6">
					{animeList.map(anime => {
						const statusInfo = getStatusInfo(anime.status);
						const progressPercent = (anime.progress / anime.totalEpisodes) * 100;
						
						return (
							<div class="group relative bg-[var(--card-bg)] border border-[var(--line-divider)] rounded-[var(--radius-large)] overflow-hidden transition-all duration-300 hover:shadow-lg hover:scale-[1.02]">
								<!-- 封面区域 - 竖屏比例 -->
								<div class="relative aspect-[2/3] overflow-hidden">
									<a href={anime.link} target="_blank" rel="noopener noreferrer" class="block w-full h-full">
										<ImageWrapper 
											src={anime.cover} 
											alt={anime.title}
											class="w-full h-full object-cover transition-transform duration-300 group-hover:scale-110"
										/>
										<div class="absolute inset-0 bg-gradient-to-t from-black/60 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300">
											<div class="absolute inset-0 flex items-center justify-center">
												<div class="w-12 h-12 rounded-full bg-white/90 flex items-center justify-center">
													<svg class="w-6 h-6 text-gray-800 ml-1" fill="currentColor" viewBox="0 0 24 24">
														<path d="M8 5v14l11-7z"/>
													</svg>
												</div>
											</div>
										</div>
									</a>
									
									<!-- 状态标签 -->
									<div class={`absolute top-2 left-2 px-2 py-1 rounded-md text-xs font-medium ${statusInfo.class}`}>
										<span class="mr-1" set:html={statusInfo.icon}></span>
										<span>{statusInfo.text}</span>
									</div>
									
									<!-- 评分 -->
									<div class="absolute top-2 right-2 bg-black/70 text-white px-2 py-1 rounded-md text-xs font-medium flex items-center gap-1">
										<svg class="w-3 h-3 text-yellow-400" fill="currentColor" viewBox="0 0 20 20">
											<path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
										</svg>
										<span>{anime.rating}</span>
									</div>
									
									<!-- 进度条 - 在封面底部 -->
									{anime.status === 'watching' && (
										<div class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/80 to-transparent p-2">
											<div class="w-full bg-white/20 rounded-full h-1.5 mb-1">
												<div class="bg-gradient-to-r from-emerald-400 to-teal-400 h-1.5 rounded-full transition-all duration-300" style={`width: ${progressPercent}%`}></div>
											</div>
											<div class="text-white text-xs font-medium">
												{anime.progress}/{anime.totalEpisodes} ({Math.round(progressPercent)}%)
											</div>
										</div>
									)}
								</div>
								
								<!-- 内容区域 - 紧凑设计 -->
								<div class="p-3">
									<h3 class="text-sm font-bold text-black/90 dark:text-white/90 mb-1 line-clamp-2 leading-tight">{anime.title}</h3>
									<p class="text-black/60 dark:text-white/60 text-xs mb-2 line-clamp-2">{anime.description}</p>
									
									<!-- 详细信息 - 更紧凑 -->
									<div class="space-y-1 text-xs">
										<div class="flex justify-between">
												<span class="text-black/50 dark:text-white/50">{i18n(I18nKey.animeYear)}</span>
											<span class="text-black/70 dark:text-white/70">{anime.year}</span>
										</div>
										<div class="flex justify-between">
												<span class="text-black/50 dark:text-white/50">{i18n(I18nKey.animeStudio)}</span>
											<span class="text-black/70 dark:text-white/70 truncate ml-2">{anime.studio}</span>
										</div>
										<div class="flex flex-wrap gap-1 mt-2">
											{anime.genre.map(g => (
												<span class="px-1.5 py-0.5 bg-[var(--btn-regular-bg)] text-black/70 dark:text-white/70 rounded text-xs">{g}</span>
											))}
										</div>
									</div>
								</div>
							</div>
						);
					})}
				</div>
			</div>
		</div>
	</div>
</MainGridLayout>