---
title: 给Wordpress评论者信息栏加入新浪微博账号输入框
author: Feng
type: post
published: 2016-10-30T04:48:00+00:00
url: /it/319.html
hera_post_view:
  - 8
categories:
  - IT网络
tags:
  - Wordpress

---
首先就是无论你采用哪种方法，都要在 `functions.php` 中加入如下代码:

<pre><code class="language-php">add_action( &#039;comment_post&#039;,&#039;save_comment_meta_data&#039; );
function save_comment_meta_data( $comment_id ) {
add_comment_meta( $comment_id, &#039;sinawb&#039;, $_POST[&#039;sinawb&#039;] );
$expire = time() + 99999999;
$domain = ($_SERVER[&#039;HTTP_HOST&#039;] != &#039;localhost&#039;) ? $_SERVER[&#039;HTTP_HOST&#039;] : false; // make cookies work with localhost
setcookie(&#039;bigfa_sinawb&#039;,$_POST[&#039;sinawb&#039;],$expire,&#039;/&#039;,$domain,false);
}
add_filter( &#039;get_comment_author_link&#039;,    &#039;attach_twitter_to_author&#039; );
function attach_twitter_to_author( $author ) {
$tw = get_comment_meta( get_comment_ID(), &#039;sinawb&#039;, true );
if($tw)
$author .= " / &lt;a href=&#039;&lt;a href="http://weibo.com/n/$tw"&gt;http://weibo.com/n/$tw&lt;/a&gt;&#039; title=&#039;@$tw&#039; target=&#039;_blank&#039;&gt;@$tw&lt;/a&gt;";
return $author;
}</code></pre>

如果是自定义评论，则在 `comments.php` 相应位置:

如果是默认的comment_form，则下面的代码加到 `functions.php` 中:

<pre><code class="language-php">add_filter( &#039;comment_form_defaults&#039;,    &#039;change_comment_form_defaults&#039;);
function change_comment_form_defaults($default) {
    $commenter = wp_get_current_commenter();
    $default[&#039;fields&#039;][&#039;url&#039;] .= &#039;&lt;p class="comment-form-author"&gt;&lt;label id="author_sinawb" for="sinawb"&gt;Weibo&lt;input id="sinawb" type="text" tabindex="5" value="&#039;;
    if(isset($_COOKIE[&#039;bigfa_sinawb&#039;])) $default[&#039;fields&#039;][&#039;url&#039;] .= $_COOKIE[&#039;bigfa_sinawb&#039;];
    $default[&#039;fields&#039;][&#039;url&#039;] .=&#039;" name="sinawb"&gt;&lt;/label&gt;&lt;/p&gt;&#039;;
    return $default;
}</code></pre>